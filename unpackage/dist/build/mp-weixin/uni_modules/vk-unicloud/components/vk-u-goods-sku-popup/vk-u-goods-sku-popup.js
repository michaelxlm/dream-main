(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["uni_modules/vk-unicloud/components/vk-u-goods-sku-popup/vk-u-goods-sku-popup"],{"4d29":function(e,t,n){"use strict";n.d(t,"b",(function(){return u})),n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return o}));var o={vkUNumberBox:function(){return n.e("uni_modules/vk-unicloud/components/vk-u-number-box/vk-u-number-box").then(n.bind(null,"c06e"))}},u=function(){var e=this,t=e.$createElement,n=(e._self._c,e._f("priceFilter")(e.selectShop.price)),o=e.selectArr.join(" "),u=e.__map(e.goodsInfo[e.specListName],(function(t,n){var o=e.__get_orig(t),u=e.__map(t.list,(function(t,o){var u=e.__get_orig(t),r=e.__get_style([t.ishow?"":e.disableStyle,t.ishow?e.btnStyle:"",e.subIndex[n]==o?e.activedStyle:""]);return{$orig:u,s0:r}}));return{$orig:o,l0:u}}));e.$mp.data=Object.assign({},{$root:{f0:n,g0:o,l1:u}})},r=[]},"6e9b":function(e,t,n){},"97f1":function(e,t,n){"use strict";var o=n("6e9b"),u=n.n(o);u.a},"98ff":function(e,t,n){"use strict";n.r(t);var o=n("4d29"),u=n("e3b8");for(var r in u)"default"!==r&&function(e){n.d(t,e,(function(){return u[e]}))}(r);n("97f1");var i,s=n("f0c5"),a=Object(s["a"])(u["default"],o["b"],o["c"],!1,null,"80f19a22",null,!1,o["a"],i);t["default"]=a.exports},df51:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o,u,r=i(n("a34a"));function i(e){return e&&e.__esModule?e:{default:e}}function s(e){return l(e)||f(e)||c(e)||a()}function a(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(e,t){if(e){if("string"===typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(e,t):void 0}}function f(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function l(e){if(Array.isArray(e))return d(e)}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function p(e,t,n,o,u,r,i){try{var s=e[r](i),a=s.value}catch(c){return void n(c)}s.done?t(a):Promise.resolve(a).then(o,u)}function m(e){return function(){var t=this,n=arguments;return new Promise((function(o,u){var r=e.apply(t,n);function i(e){p(r,o,u,i,s,"next",e)}function s(e){p(r,o,u,i,s,"throw",e)}i(void 0)}))}}var y={name:"vk-u-goods-sku-popup",props:{value:{Type:Boolean,default:!1},goodsId:{Type:String,default:""},action:{Type:String,default:""},noStockText:{Type:String,default:"该商品已抢完"},stockText:{Type:String,default:"库存"},goodsIdName:{Type:String,default:"_id"},skuIdName:{Type:String,default:"_id"},skuListName:{Type:String,default:"sku_list"},specListName:{Type:String,default:"spec_list"},stockName:{Type:String,default:"stock"},skuName:{Type:String,default:"sku_name"},skuArrName:{Type:String,default:"sku_name_arr"},defaultSingleSkuName:{Type:String,default:"默认"},mode:{Type:Number,default:1},maskCloseAble:{Type:Boolean,default:!0},borderRadius:{Type:[String,Number],default:0},goodsThumbName:{Type:[String],default:"goods_thumb"},minBuyNum:{Type:Number,default:1},maxBuyNum:{Type:Number,default:1e5},stepBuyNum:{Type:Number,default:1},stepStrictly:{Type:Boolean,default:!1},customAction:{Type:[Function],default:null},priceColor:{Type:String,default:"#fe560a"},buyNowText:{Type:String,default:"立即购买"},buyNowColor:{Type:String,default:"#ffffff"},buyNowBackgroundColor:{Type:String,default:"#fe560a"},addCartText:{Type:String,default:"加入购物车"},addCartColor:{Type:String,default:"#ffffff"},addCartBackgroundColor:{Type:String,default:"#ff9402"},disableStyle:{Type:Object,default:null},activedStyle:{Type:Object,default:null},btnStyle:{Type:Object,default:null},showClose:{Type:Boolean,default:!0},closeImage:{Type:String,default:"https://img.alicdn.com/imgextra/i1/121022687/O1CN01ImN0O11VigqwzpLiK_!!121022687.png"}},data:function(){return{complete:!1,goodsInfo:{},isShow:!1,initKey:!0,shopItemInfo:{},selectArr:[],subIndex:[],selectShop:{},selectNum:this.minBuyNum,outFoStock:!1}},created:function(){o=this,u=o.vk,o.value&&o.open()},mounted:function(){},methods:{init:function(){o.selectArr=[],o.subIndex=[],o.selectShop={},o.selectNum=o.minBuyNum,o.outFoStock=!1,o.shopItemInfo={};var e=o.specListName;o.goodsInfo[e].map((function(e){o.selectArr.push(""),o.subIndex.push(-1)})),o.checkItem(),o.checkInpath(-1),o.autoClickSku()},findGoodsInfo:function(){if("undefined"==typeof u)return o.toast("未找到vk依赖"),!1;u.callFunction({url:o.action,title:"请求中...",data:{goods_id:o.goodsId},success:function(e){o.updateGoodsInfo(e.goodsInfo)}})},updateGoodsInfo:function(e){var t=o.skuListName;"{}"===JSON.stringify(o.goodsInfo)||o.goodsInfo[o.goodsIdName]!==e[o.goodsIdName]?(o.goodsInfo=e,o.initKey=!0):o.goodsInfo[t]=e[t],o.initKey&&(o.initKey=!1,o.init());var n=o.getListItem(o.goodsInfo[t],o.skuIdName,o.selectShop[o.skuIdName]);Object.assign(o.selectShop,n),o.complete=!0,o.$emit("open",!0),o.$emit("input",!0)},open:function(){return m(r.default.mark((function e(){var t,n;return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=!0,o.skuListName,!o.customAction||"function"!==typeof o.customAction){e.next=16;break}return e.next=5,o.customAction();case 5:if(n=e.sent,!n||"object"!=typeof n||"{}"==JSON.stringify(n)){e.next=11;break}t=!1,o.updateGoodsInfo(n),e.next=14;break;case 11:return o.toast("未获取到商品信息"),o.$emit("input",!1),e.abrupt("return",!1);case 14:e.next=17;break;case 16:t&&o.findGoodsInfo();case 17:case"end":return e.stop()}}),e)})))()},close:function(e){"close"==e?(o.$emit("input",!1),o.$emit("close","close")):"mask"==e&&o.maskCloseAble&&(o.$emit("input",!1),o.$emit("close","mask"))},moveHandle:function(){},skuClick:function(e,t,n,u){e.ishow&&(o.selectArr[t]!=e.name?(o.$set(o.selectArr,t,e.name),o.$set(o.subIndex,t,u)):(o.$set(o.selectArr,t,""),o.$set(o.subIndex,t,-1)),o.checkInpath(t),o.checkSelectShop())},checkSelectShop:function(){o.selectArr.every((function(e){return""!=e}))?(o.selectShop=o.shopItemInfo[o.selectArr],o.selectNum=o.minBuyNum):o.selectShop={}},checkInpath:function(e){for(var t=o.specListName,n=o.goodsInfo[t],u=0,r=n.length;u<r;u++)if(u!=e)for(var i=n[u].list.length,a=0;a<i;a++)if(-1==o.subIndex[u]||a!=o.subIndex[u]){var c=s(o.selectArr);o.$set(c,u,n[u].list[a].name);var f=c.filter((function(e){return""!==e&&"undefined"!==typeof e}));o.shopItemInfo.hasOwnProperty(f)?n[u].list[a].ishow=!0:n[u].list[a].ishow=!1}o.$set(o.goodsInfo,t,n)},checkItem:function(){for(var e=o.skuListName,t=o.goodsInfo[e],n=0,u=0;u<t.length;u++)t[u][o.stockName]<=0?(t.splice(u,1),u--):n+=t[u][o.stockName];n<=0&&(o.outFoStock=!0);t.reduce((function(e,t){return e.concat(t[o.skuArrName].reduce((function(e,n){return e.concat(e.map((function(e){return o.shopItemInfo.hasOwnProperty([].concat(s(e),[n]))||(o.shopItemInfo[[].concat(s(e),[n])]=t),[].concat(s(e),[n])})))}),[[]]))}),[[]])},checkSelectComplete:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=o.selectShop;t&&t[o.skuIdName]?o.selectNum<=t[o.stockName]?"function"==typeof e.success&&e.success(t):o.toast(o.stockText+"不足","none"):o.toast("请先选择对应规格","none")},addCart:function(){o.checkSelectComplete({success:function(e){e.buy_num=o.selectNum,o.$emit("add-cart",e),setTimeout((function(){o.init()}),300)}})},buyNow:function(){o.checkSelectComplete({success:function(e){e.buy_num=o.selectNum,o.$emit("buy-now",e)}})},toast:function(t,n){e.showToast({title:t,icon:n})},getListItem:function(e,t,n){var o;for(var u in e)if("object"==typeof n){if(JSON.stringify(e[u][t])===JSON.stringify(n)){o=e[u];break}}else if(e[u][t]===n){o=e[u];break}return o},autoClickSku:function(){var e=o.goodsInfo[o.skuListName],t=o.goodsInfo[o.specListName];if(1==t.length)for(var n=t[0].list,u=0;u<n.length;u++){var r=o.getListItem(e,o.skuArrName,[n[u].name]);if(r){o.skuClick(n[u],0,{},u);break}}}},filters:{priceFilter:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return"string"==typeof e&&(e=parseFloat(e)),(e/100).toFixed(2)}},computed:{maxBuyNumCom:function(){var e=o.maxBuyNum,t=o.stockName;return o.selectShop&&"undefined"!==typeof o.selectShop[t]&&e>o.selectShop[t]&&(e=o.selectShop[t]),e},isManyCom:function(){var e=this,t=e.goodsInfo,n=e.defaultSingleSkuName,o=e.specListName,u=!0;return t[o]&&1===t[o].length&&1===t[o][0].list.length&&t[o][0].name===n&&(u=!1),u}},watch:{value:function(e){e&&o.open()}}};t.default=y}).call(this,n("543d")["default"])},e3b8:function(e,t,n){"use strict";n.r(t);var o=n("df51"),u=n.n(o);for(var r in o)"default"!==r&&function(e){n.d(t,e,(function(){return o[e]}))}(r);t["default"]=u.a}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'uni_modules/vk-unicloud/components/vk-u-goods-sku-popup/vk-u-goods-sku-popup-create-component',
    {
        'uni_modules/vk-unicloud/components/vk-u-goods-sku-popup/vk-u-goods-sku-popup-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("98ff"))
        })
    },
    [['uni_modules/vk-unicloud/components/vk-u-goods-sku-popup/vk-u-goods-sku-popup-create-component']]
]);
